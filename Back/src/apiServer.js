CÊR¾«1Ì³¡8RR5=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡{)È­C»Î½î/“Wit=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡¦D0JùÓ å=”d›„¥Q…=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡Úûÿ0`u¡ErÉ¥âjæ=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡|ƒ	¶ŸkVşã{ÚÏd=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡ÁL*¦>h·ğªlîe_bâ=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡¨F$H	‹:oî/£SR5=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡”'ÔŸ˜&b<0œğÓb¡ìë=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡=tQoçÖ¥;\ÿ“é!‡                 res.json(rows);
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                    res.sendStatus(500);
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
        });

});
app.post('/insertaAplicativo', rutasProtegidas, jsonParser, (req, res) => {
    //console.log(JSON.stringify(req.body));

    // No vamos a usar por el url
    cveAplicativo = req.body.clave;
    nomCorto = req.body.nombre;
    desAplicativo = req.body.descripcion;
    
    let params = [];
    params.push(nomCorto);
    params.push(desAplicativo);
    
    const query = 'INSERT INTO AGDC_CAT_APLICATIVO (REF_NOMBRE_CORTO,DES_APLICATIVO)' +
        'VALUES(?,?); ';
    pool.getConnection()
        .then(conn => {
            conn.query(query, params)
                .then((salida) => {
                    conn.end();
                    res.json(salida);
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                    res.sendStatus(500);
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
            res.sendStatus(500);
        });

});
app.post('/actualizaAplicativo', rutasProtegidas, jsonParser, (req, res) => {
    //console.log(JSON.stringify(req.body));

    // No vamos a usar por el url
    cveAplicativo = req.body.clave;
    nomCorto = req.body.nombre;
    desAplicativo = req.body.descripcion;
    
    let params = [];
    params.push(nomCorto);
    params.push(desAplicativo);
    params.push(cveAplicativo);
    
    const query = 'UPDATE AGDC_CAT_APLICATIVO SET REF_NOMBRE_CORTO=?, DES_APLICATIVO= ?' +
        ' WHERE CVE_APLICATIVO= ?; ';
    pool.getConnection()
        .then(conn => {
            conn.query(query, params)
                .then((salida) => {
                    conn.end();
                    res.json(salida);
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                    res.sendStatus(500);
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
            res.sendStatus(500);
        });

});

app.post('/consultaAplicativos', rutasProtegidas, jsonParser, (req, res) => {

    //console.log(JSON.stringify(req.body));


    let params = [];


    const query = 'SELECT CVE_APLICATIVO as clave,' +
        '	REF_NOMBRE_CORTO as nombre, ' +
        ' DES_APLICATIVO as descripcion ' +
        ' FROM AGDC_CAT_APLICATIVO;';

    
    pool.getConnection()
        .then(conn => {
            conn.query(query, params)
                .then((rows) => {
                    conn.end();
                    res.json(rows);
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                    res.sendStatus(500);
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
        });

});

app.post('/consultaManejadores', rutasProtegidas, jsonParser, (req, res) => {

    //console.log(JSON.stringify(req.body));


    let params = [];


    const query = 'SELECT ' +
        '   CVE_DBMS AS clave, ' +
        '   DES_DBMS AS descripcion ' +
        'FROM AGDC_CAT_DBMS;';

    
    pool.getConnection()
        .then(conn => {
            conn.query(query, params)
                .then((rows) => {
                    
                    conn.end();
                    res.json(rows);
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                    res.sendStatus(500);
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
        });

});
app.post('/login', rutasProtegidas, jsonParser, (req, res) => {

    //console.log(JSON.stringify(req.body));

    // No vamos a usar por el url
    const userName = req.body.userName;
    //const userName = req.body.userName;
    const password = req.body.password;

    let params = [];
    params.push(userName);
    params.push(password);

    const query = 'SELECT CVE_USUARIO, REF_NOMBRE_USUARIO, REF_PATERNO_USUARIO, REF_MATERNO_USUARIO, REF_IS from AGDT_CTL_USUARIOS where CVE_USUARIO = ? and PSW_USUARIO = ?';
    
    pool.getConnection()
        .then(conn => {
            conn.query(query, params)
                .then((rows) => {
                    
                    // No tirar el servicio si hay error en el query, solo devolver falso.
                    if (rows.length) {
                        conn.end();
                        res.send({
                            outCode: 1,
                            outDesc: "OperaciÃ³n exitosa",
                            outCveUsr: rows[0].CVE_USUARIO,
                            outNomUsr: rows[0].REF_NOMBRE_USUARIO,
                            outPatUsr: rows[0].REF_PATERNO_USUARIO,
                            outMatUsr: rows[0].REF_MATERNO_USUARIO,
                            outIsUsr: rows[0].REF_IS
                        });
                    } else {
                        conn.end();
                        res.send({
                            outCode: 2,
                            outDesc: "Usuario/Password Incorrecto!"
                        });
                    }
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                    res.sendStatus(500);
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
        });

});

function saveCambioPassword(req, res,cveUsuario, passwordNvo) {

    let params = [];
    params.push(passwordNvo);
    params.push(cveUsuario);
    const query = 'UPDATE AGDT_CTL_USUARIOS SET PSW_USUARIO = ? ' +
        ' WHERE CVE_USUARIO = ? ';
    pool.getConnection()
        .then(conn => {
            conn.query(query, params)
                .then((salida) => {
                    conn.end();
                    res.send(salida);
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                    res.sendStatus(500);
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
            res.sendStatus(500);
        });

}

app.post('/cambioPassword', rutasProtegidas, jsonParser, (req, res) => {

    //console.log(JSON.stringify(req.body));


    const cveUsuario = req.body.cveUsuario;
    const password = req.body.password;
    const passwordNvo = req.body.passwordNvo;

    let params = [];
    params.push(cveUsuario);
    params.push(password);

    let query = 'SELECT CVE_USUARIO from AGDT_CTL_USUARIOS WHERE CVE_USUARIO = ? and PSW_USUARIO = ?';
    
    pool.getConnection()
        .then(conn => {
            conn.query(query, params)
                .then((rows) => {
                    if (rows.length) {
                        conn.end();
                        saveCambioPassword(req, res, cveUsuario,passwordNvo);
                    } else {
                        conn.end();
                        res.send({
                            "affectedRows": 0,
                            "insertId": 0,
                            "warningStatus": 0,
                            "description":"Usuario/Password Incorrecto!"
                        });
                    }
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                    res.sendStatus(500);
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
            res.sendStatus(500);
        });
    
});

app.post('/insertaServidor', rutasProtegidas, jsonParser, (req, res) => {
    //console.log(JSON.stringify(req.body));

    // No vamos a usar por el url
    idColaborador = req.body.idColaborador;
    cveAplicativo = req.body.idAplicativo;
    nomServidor = req.body.nomServidor;
    cveDbms = req.body.idDbms;
    verDbms = req.body.verDbms;
    ambiente = req.body.ambiente;
    ip = req.body.ip;
    puerto = req.body.puerto;
    sid = req.body.sid;
    esquema = req.body.esquema;
    bdUsuario = req.body.bdUsuario;
    bdPassword = req.body.bdPassword;
    bdUsuarioTipo = req.body.bdUsuarioTipo;
    soNombre = req.body.soNombre;
    soUsuario = req.body.soUsuario;
    soPassword = req.body.soPassword;
    observaciones = req.body.observaciones;
    seRespalda = req.body.seRespalda;
    site = req.body.site;


    let params = [];
    params.push(idColaborador);
    params.push(cveAplicativo);
    params.push(nomServidor);
    params.push(cveDbms);
    params.push(verDbms);
    params.push(ambiente);
    params.push(ip);
    params.push(puerto);
    params.push(sid);
    params.push(esquema);
    params.push(bdUsuario);
    params.push(bdPassword);
    params.push(bdUsuarioTipo);
    params.push(soNombre);
    params.push(soUsuario);
    params.push(soPassword);
    params.push(observaciones);
    params.push(seRespalda);
    params.push(site);
    params.push(idColaborador);

    const query = 'INSERT INTO AGDT_PCS_INVENTARIO_SERVIDORES (CVE_USUARIO,CVE_APLICATIVO,' +
        'REF_NOMBRE_SERVIDOR,CVE_DBMS,REF_VERSION_DBMS,REF_AMBIENTE,REF_IP,REF_PUERTO,' +
        'REF_SID,REF_ESQUEMA,REF_BD_USUARIO,REF_BD_PASSWORD,REF_BD_USUARIO_TIPO,' +
        'REF_SISTEMA_OPERATIVO,REF_SO_USUARIO,REF_SO_PASSWORD,REF_OBSERVACIOES,IND_SE_RESPALDA,REF_SITE,' +
        'CVE_USUARIO_ALTA,FEC_ALTA_REGISTRO)' +
        'VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,NOW()); ';
    pool.getConnection()
        .then(conn => {
            conn.query(query, params)
                .then((salida) => {
                    conn.end();
                    res.json(salida);
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                    res.sendStatus(500);
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
        });

});
function saveHistoricoServidores(cveInventario) {
    let params = [];
    params.push(cveInventario);
    const query = 'INSERT INTO AGDT_HIS_INVENTARIO_SERVIDORES ' +
        '        (CVE_INVENTARIO_SERVIDORES,CVE_USUARIO,CVE_APLICATIVO,REF_NOMBRE_SERVIDOR,CVE_DBMS,REF_VERSION_DBMS,REF_AMBIENTE,REF_IP,REF_PUERTO,REF_SID,REF_ESQUEMA,REF_BD_USUARIO,REF_BD_PASSWORD,REF_BD_USUARIO_TIPO,REF_SISTEMA_OPERATIVO,REF_SO_USUARIO,REF_SO_PASSWORD,REF_OBSERVACIOES,IND_SE_RESPALDA,REF_SITE,CVE_USUARIO_ALTA,FEC_ALTA_REGISTRO,CVE_USUARIO_MODIFICA,FEC_MODIFICA_REGISTRO,FEC_BAJA)' +
        ' (SELECT CVE_INVENTARIO_SERVIDORES,CVE_USUARIO,CVE_APLICATIVO,REF_NOMBRE_SERVIDOR,CVE_DBMS,REF_VERSION_DBMS,REF_AMBIENTE,REF_IP,REF_PUERTO,REF_SID,REF_ESQUEMA,REF_BD_USUARIO,REF_BD_PASSWORD,REF_BD_USUARIO_TIPO,REF_SISTEMA_OPERATIVO,REF_SO_USUARIO,REF_SO_PASSWORD,REF_OBSERVACIOES,IND_SE_RESPALDA,REF_SITE,CVE_USUARIO_ALTA,FEC_ALTA_REGISTRO,CVE_USUARIO_MODIFICA,FEC_MODIFICA_REGISTRO,FEC_BAJA ' +
        ' FROM AGDT_PCS_INVENTARIO_SERVIDORES WHERE CVE_INVENTARIO_SERVIDORES = ?);';
    pool.getConnection()
        .then(conn => {
            conn.query(query, params)
                .then((salida) => {
                    conn.end();
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
        });

}
app.post('/actualizaServidor', rutasProtegidas, jsonParser, (req, res) => {
    //console.log(JSON.stringify(req.body));

    // No vamos a usar por el url
    cveInventario = req.body.cveInventario;
    idColaborador = req.body.idColaborador;
    cveAplicativo = req.body.idAplicativo;
    nomServidor = req.body.nomServidor;
    cveDbms = req.body.idDbms;
    verDbms = req.body.verDbms;
    ambiente = req.body.ambiente;
    ip = req.body.ip;
    puerto = req.body.puerto;
    sid = req.body.sid;
    esquema = req.body.esquema;
    bdUsuario = req.body.bdUsuario;
    bdPassword = req.body.bdPassword;
    bdUsuarioTipo = req.body.bdUsuarioTipo;
    soNombre = req.body.soNombre;
    soUsuario = req.body.soUsuario;
    soPassword = req.body.soPassword;
    observaciones = req.body.observaciones;
    seRespalda = req.body.seRespalda;
    site = req.body.site;


    let params = [];


    params.push(cveAplicativo);
    params.push(nomServidor);
    params.push(cveDbms);
    params.push(verDbms);
    params.push(ambiente);
    params.push(ip);
    params.push(puerto);
    params.push(sid);
    params.push(esquema);
    params.push(bdUsuario);
    params.push(bdPassword);
    params.push(bdUsuarioTipo);
    params.push(soNombre);
    params.push(soUsuario);
    params.push(soPassword);
    params.push(observaciones);
    params.push(seRespalda);
    params.push(site);
    params.push(idColaborador);
    params.push(cveInventario);

    const query = 'UPDATE AGDT_PCS_INVENTARIO_SERVIDORES ' +
        ' SET CVE_APLICATIVO = ? ,' +
        'REF_NOMBRE_SERVIDOR = ? ,CVE_DBMS = ? ,REF_VERSION_DBMS = ? ,REF_AMBIENTE = ? ,REF_IP = ? ,REF_PUERTO = ? ,' +
        'REF_SID = ? ,REF_ESQUEMA = ? ,REF_BD_USUARIO = ? ,REF_BD_PASSWORD = ? ,REF_BD_USUARIO_TIPO = ? ,' +
        'REF_SISTEMA_OPERATIVO = ? ,REF_SO_USUARIO = ? ,REF_SO_PASSWORD = ? ,REF_OBSERVACIOES = ? ,IND_SE_RESPALDA = ? ,REF_SITE = ? ,' +
        'CVE_USUARIO_MODIFICA = ?, FEC_MODIFICA_REGISTRO = NOW() ' +
        ' WHERE CVE_INVENTARIO_SERVIDORES = ?';
    saveHistoricoServidores(cveInventario);
    pool.getConnection()
        .then(conn => {
            conn.query(query, params)
                .then((salida) => {
                    conn.end();
                    res.json(salida);
                })
                .catch(err => {
                    console.error(err.message);
                    conn.end();
                    res.sendStatus(500);
                })
        }).catch(err => {
            console.error("la conexiÃ³n no se pudo onbtener del pool" + err);
        });

});